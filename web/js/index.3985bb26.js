import{au as k,av as S,an as O,aw as A,ax as g,ay as I,az as c,aA as r,aB as o,aC as y,F as U,aD as W,c as w,aE as L,r as b,B as h,aF as q,aG as d,aH as V,aI as E,aJ as J,aK as K}from"./chunks/vendor.e462bc93.js";import{N as X,a as H,b as Q,c as C,d as Y,e as $,f as Z,g as ee,h as te,i as se,j as ne,k as ae,u as re,l as oe,m as ie,n as le,o as P,p as ce}from"./chunks/navie-ui.5ad75a71.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))u(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const p of i.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&u(p)}).observe(document,{childList:!0,subtree:!0});function a(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function u(t){if(t.ep)return;t.ep=!0;const i=a(t);fetch(t.href,i)}})();const ue=""+new URL("../img/ovpnmgr.png",import.meta.url).href,_=k.create({baseURL:{}.VUE_APP_BASE_API,timeout:5e3});_.interceptors.request.use(e=>e,e=>(console.log(e),Promise.reject(e)));_.interceptors.response.use(e=>{const{status:s,data:a}=e;switch(s){case 209:window.$message.warning(a.response.msg,{duration:2e3})}return Promise.resolve(a)},e=>{const{status:s,data:a}=e.response;switch(s){case 401:case 403:window.$message.error("No Permission, Please Login!",{duration:2e3});break;default:window.$message.error(a.response.msg||e.message,{duration:2e3})}return Promise.reject(e)});function M(e){return _({url:"/api/vpn/info",method:"get",params:e})}const de=S("vpn",()=>{const e=O({});return{vpnInfo:e,getVpnInfo:async()=>{const a=await M();e.value=a}}});const pe={__name:"VpnInfo",setup(e){const s=de(),{vpnInfo:a}=A(s);return Object.keys(a.value).length===0&&M().then(u=>{s.vpnInfo.value=u}).catch(u=>{console.error("Error fetching VPN info:",u)}),(u,t)=>(g(),I(o(Y),{bordered:""},{default:c(()=>[r(o(X),null,{default:c(()=>[(g(!0),y(U,null,W(o(a).value,(i,p,x)=>(g(),I(o(H),{key:x},{default:c(()=>[r(o(Q),{cols:16,"item-responsive":""},{default:c(()=>[r(o(C),{class:"name",span:"0 500:3"},{default:c(()=>[w(L(p.toUpperCase()),1)]),_:2},1024),r(o(C),{class:"value",span:"16 500:13"},{default:c(()=>[w(L(i),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}))}};function T(e){return _({url:"/api/user/show",method:"get",timeout:6e4,params:e})}function fe(e){return _({url:"/api/user/add",method:"post",data:e})}function me(e){return _({url:`/api/user/revoke/${e}`,method:"delete"})}const ge=S("users",()=>{const e=O([]);return{users:e,getUsersList:async()=>{const t=await T();e.value=t},addUserLocal:t=>{e.value.unshift(t)},delUserLocal:t=>{let i=e.value.findIndex(p=>p.username===t);i!==-1&&e.value.splice(i,1)}}});const B=(e,s)=>{const a=e.__vccOpts||e;for(const[u,t]of s)a[u]=t;return a},D=e=>(V("data-v-1f67f66b"),e=e(),E(),e),_e={class:"controlbar-wrapper"},ve={class:"controlbar-left"},he=D(()=>d("span",{style:{"margin-right":"5px"}},"Edit",-1)),we={class:"controlbar-right"},ye=D(()=>d("div",null,"username",-1)),be={__name:"UserManager",setup(e){const s=ge(),{users:a}=A(s);Object.keys(a.value).length===0&&T().then(l=>{s.users.value=l.response.users}).catch(l=>{console.error("Error fetching users:",l)});const u={pageSize:10},t=b(!1),i=b([{title:"User",key:"username",align:"center",titleAlign:"center",minWidth:50},{title:"Manage",key:"manage",align:"center",titleAlign:"center",minWidth:200,render(l){return h("div",[h($,{text:!0,size:"small",strong:!0,type:"primary",style:{display:t.value?"none":"inline-flex"},onClick:()=>p(l.username)},{default:()=>"Download Ovpn File",icon:()=>h(Z,{color:"#000",size:24},{default:()=>h(q)})}),h($,{strong:!0,size:"small",type:"error",style:{display:t.value?"inline-flex":"none"},onClick:()=>x(l)},{default:()=>"delete"})])}}]);function p(l){k({method:"get",url:`/api/user/cert/${l}.ovpn`,responseType:"blob"}).then(n=>{let f=n.data;if(!f)return;let G=window.URL.createObjectURL(new Blob([f])),m=document.createElement("a");m.style.display="none",m.href=G,m.setAttribute("download",`${l}.ovpn`),document.body.appendChild(m),m.click(),window.URL.revokeObjectURL(m.href),document.body.removeChild(m)}).catch(n=>{window.$message.error(`${n.response.status} ${n.response.statusText}`,{duration:2e3})})}function x(l){window.$dialog.warning({title:"Warning",content:`Are you sure to delete user [ ${l.username} ]?`,positiveText:"Sure",negativeText:"Cancel",style:"position: fixed; top: 11rem; left: 50%; transform: translateX(-50%)",onPositiveClick:()=>{me(l.username).then(n=>{console.log(n.response.msg),window.$message.success(`[ ${l.username} ] is deleted`,{duration:2e3}),s.delUserLocal(l.username)}).catch(n=>{window.$message.error(`Error while deleting users: ${n}`,{duration:2e3})})}})}const N=b(!1),v=b("");function z(){window.$message.warning("Canceled!")}function F(){const l=JSON.stringify({username:v.value});fe(l).then(n=>{console.log(n.response.msg,n.status),n.status==="success"&&(s.addUserLocal({username:v.value}),window.$message.success(`[${v.value}] creat success`,{duration:2e3}))}).catch(n=>{window.$message.error(`Error when creating users: ${n}`,{duration:2e3})})}return(l,n)=>(g(),y(U,null,[d("div",_e,[d("div",ve,[he,r(o(ee),{size:"small",value:t.value,"onUpdate:value":n[0]||(n[0]=f=>t.value=f)},null,8,["value"])]),d("div",we,[r(o($),{onClick:n[1]||(n[1]=f=>N.value=!0),size:"small",color:"#44aaee"},{default:c(()=>[w(" Create ")]),_:1})])]),r(o(se),{show:N.value,"onUpdate:show":n[3]||(n[3]=f=>N.value=f),preset:"dialog",title:"create user","positive-text":"submit","negative-text":"cancel",style:{position:"fixed",top:"11rem",left:"50%",transform:"translateX(-50%)"},onPositiveClick:F,onNegativeClick:z},{default:c(()=>[d("div",null,[ye,r(o(te),{value:v.value,"onUpdate:value":n[2]||(n[2]=f=>v.value=f),type:"text",placeholder:"eg: ovpn-20231212"},null,8,["value"])])]),_:1},8,["show"]),r(o(ne),{columns:i.value,bordered:!1,"single-line":!1,striped:!0,"scroll-x":300,data:o(s).users.value,pagination:u,"paginate-single-page":!1},null,8,["columns","data"]),r(o(ae),{bottom:5,right:5,"visibility-height":300})],64))}},xe=B(be,[["__scopeId","data-v-1f67f66b"]]),Ne={__name:"MessageContainer",setup(e){return window.$message=re(),(s,a)=>(g(),y("div"))}},$e={__name:"DialogContainer",setup(e){return window.$dialog=oe(),(s,a)=>(g(),y("div"))}};const R=e=>(V("data-v-acb9af91"),e=e(),E(),e),Ue=R(()=>d("header",null,[d("img",{src:ue,style:{width:"40px",height:"40px",margin:"12px 10px 0 10px"}}),d("h2",{style:{"margin-top":"12px"}},"OpenVPN Manager")],-1)),Ie={class:"wrapper"},Le=R(()=>d("footer",null,[w("Â© Based on "),d("a",{href:"https://github.com/Nyr/openvpn-install"},"OpenVPN installation script"),w(" maintained by Nyr 2023")],-1)),Ce={__name:"App",setup(e){return(s,a)=>(g(),y(U,null,[Ue,r(o(ie),null,{default:c(()=>[r(Ne)]),_:1}),r(o(le),null,{default:c(()=>[r($e)]),_:1}),d("div",Ie,[r(o(ce),{type:"segment"},{default:c(()=>[r(o(P),{name:"vpn-info",tab:"VPN Info"},{default:c(()=>[r(pe)]),_:1}),r(o(P),{name:"user-manager",tab:"User Manager"},{default:c(()=>[r(xe)]),_:1})]),_:1})]),Le],64))}},Pe=B(Ce,[["__scopeId","data-v-acb9af91"]]),j=J(Pe),ke=K();j.use(ke);j.mount("#app");
