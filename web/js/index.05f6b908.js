import{au as S,av as P,an as O,r as w,aw as T,ax as _,ay as x,az as r,aA as l,aB as a,F as b,aC as G,aD as A,c as v,aE as k,aF as p,B as h,aG as H,$ as X,v as J,aH as M,aI as R,aJ as K,aK as Q}from"./chunks/vendor.0cb8c3a3.js";import{N as Y,a as Z,b as ee,c as C,d as te,e as y,f as V,g as se,h as ae,i as ne,j as re,k as oe,l as ie,u as le,m as ce,n as ue,o as de,p as L,q as pe}from"./chunks/navie-ui.cdf35021.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))d(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&d(i)}).observe(document,{childList:!0,subtree:!0});function c(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function d(t){if(t.ep)return;t.ep=!0;const o=c(t);fetch(t.href,o)}})();const me=""+new URL("../img/ovpnmgr.png",import.meta.url).href,f=S.create({baseURL:{}.VUE_APP_BASE_API,timeout:5e3});f.interceptors.request.use(e=>e,e=>(console.log(e),Promise.reject(e)));f.interceptors.response.use(e=>{const{status:s,data:c}=e;switch(s){case 209:window.$message.warning(c.response.msg,{duration:2e3})}return Promise.resolve(c)},e=>{const{status:s,data:c}=e.response;switch(s){case 401:case 403:window.$message.error("No Permission, Please Login!",{duration:2e3});break;default:window.$message.error(c.response.msg||e.message,{duration:2e3})}return Promise.reject(e)});function E(e){return f({url:"/api/vm/info",method:"get",params:e})}function fe(){return f({url:"/api/ovpn/restart",method:"get"})}function ge(){return f({url:"/api/ovpn/status",method:"get"})}const ve=P("vpn",()=>{const e=O({}),s=w("'Status': get status<p/>'Restart': restart openvpn");return{vmIpInfo:e,ovpnStatusResult:s,getVmIpInfo:async()=>{const d=await E();e.value=d}}});const _e=["innerHTML"],he={__name:"VpnInfo",setup(e){const s=ve(),{vmIpInfo:c,ovpnStatusResult:d}=T(s);Object.keys(c.value).length===0&&E().then(i=>{s.vmIpInfo.value=i}).catch(i=>{console.error("Error fetching VPN info:",i)});function t(){window.$dialog.warning({title:"Warning",content:"Are you sure to restart openvpn service?",positiveText:"Sure",negativeText:"Cancel",style:"position: fixed; top: 11rem; left: 50%; transform: translateX(-50%)",onPositiveClick:()=>{fe().then(i=>{console.log(i.response.msg),window.$message.success("openvpn service is restart",{duration:2e3})}).catch(i=>{window.$message.error(`openvpn service restart error: ${i}`,{duration:2e3})})}})}function o(){ge().then(i=>{s.ovpnStatusResult=`<pre class="scrollable-pre">${i.response.msg}</pre>`}).catch(i=>{console.log(i),window.$message.error(`get openvpn status error: ${i}`,{duration:2e3})})}return(i,I)=>(_(),x(b,null,[r(a(te),{bordered:""},{default:l(()=>[r(a(Y),null,{default:l(()=>[(_(!0),x(b,null,G(a(c).value,($,N,U)=>(_(),A(a(Z),{key:U},{default:l(()=>[r(a(ee),{cols:16,"item-responsive":""},{default:l(()=>[r(a(C),{class:"name",span:"0 500:3"},{default:l(()=>[v(k(N.toUpperCase()),1)]),_:2},1024),r(a(C),{class:"value",span:"16 500:13"},{default:l(()=>[v(k($),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),r(a(V),{title:"Openvpn Service"},{"header-extra":l(()=>[r(a(y),{onClick:t,size:"small",type:"warning"},{default:l(()=>[v(" restart ")]),_:1}),r(a(y),{onClick:o,size:"small",type:"info"},{default:l(()=>[v(" Status ")]),_:1})]),default:l(()=>[p("div",{innerHTML:a(d)},null,8,_e)]),_:1})],64))}};function B(e){return f({url:"/api/user/show",method:"get",timeout:6e4,params:e})}function we(e){return f({url:"/api/user/add",method:"post",data:e})}function ye(e){return f({url:`/api/user/revoke/${e}`,method:"delete"})}const xe=P("users",()=>{const e=O([]);return{users:e,getUsersList:async()=>{const t=await B();e.value=t},addUserLocal:t=>{e.value.unshift(t)},delUserLocal:t=>{let o=e.value.findIndex(i=>i.username===t);o!==-1&&e.value.splice(o,1)}}});const D=(e,s)=>{const c=e.__vccOpts||e;for(const[d,t]of s)c[d]=t;return c},z=e=>(M("data-v-aa47032d"),e=e(),R(),e),$e=z(()=>p("span",{style:{"margin-right":"5px"}},"Edit",-1)),Ne=z(()=>p("div",null,"username",-1)),Ue={__name:"UserManager",setup(e){const s=xe(),{users:c}=T(s);Object.keys(c.value).length===0&&B().then(u=>{s.users.value=u.response.users}).catch(u=>{console.error("Error fetching users:",u)});const d=w(!1),t=w(!1),o=w("");function i(){window.$message.warning("Canceled!")}function I(){const u=JSON.stringify({username:o.value});we(u).then(n=>{console.log(n.response.msg,n.status),n.status==="success"&&(s.addUserLocal({username:o.value}),window.$message.success(`[${o.value}] creat success`,{duration:2e3}))}).catch(n=>{window.$message.error(`Error when creating users: ${n}`,{duration:2e3})})}const $={pageSize:10},N=w([{title:"User",key:"username",align:"center",titleAlign:"center",minWidth:50},{title:"Manage",key:"manage",align:"center",titleAlign:"center",minWidth:200,render(u){return h("div",[h(y,{text:!0,size:"small",strong:!0,type:"primary",style:{display:d.value?"none":"inline-flex"},onClick:()=>U(u.username)},{default:()=>"Download Ovpn File",icon:()=>h(se,{color:"#000",size:24},{default:()=>h(H)})}),h(y,{strong:!0,size:"small",type:"error",style:{display:d.value?"inline-flex":"none"},onClick:()=>W(u)},{default:()=>"delete"})])}}]);function U(u){S({method:"get",url:`/api/user/cert/${u}.ovpn`,responseType:"blob"}).then(n=>{let m=n.data;if(!m)return;let q=window.URL.createObjectURL(new Blob([m],{type:"application/octet-stream"})),g=document.createElement("a");g.style.display="none",g.href=q,g.setAttribute("download",`${u}.ovpn`),document.body.appendChild(g),g.click(),window.URL.revokeObjectURL(g.href),document.body.removeChild(g)}).catch(n=>{window.$message.error(`${n.response.status} ${n.response.statusText}`,{duration:2e3})})}function W(u){window.$dialog.warning({title:"Warning",content:`Are you sure to delete user [ ${u.username} ]?`,positiveText:"Sure",negativeText:"Cancel",style:"position: fixed; top: 11rem; left: 50%; transform: translateX(-50%)",onPositiveClick:()=>{ye(u.username).then(n=>{console.log(n.response.msg),window.$message.success(`[ ${u.username} ] is deleted, click [restart] will finally take effect.`,{duration:2e3}),s.delUserLocal(u.username)}).catch(n=>{window.$message.error(`Error while deleting users: ${n}`,{duration:2e3})})}})}return(u,n)=>(_(),A(a(V),{title:"User List"},{header:l(()=>[X(r(a(y),{onClick:n[0]||(n[0]=m=>t.value=!0),size:"small",color:"#44aaee"},{default:l(()=>[v(" Create ")]),_:1},512),[[J,!d.value]])]),"header-extra":l(()=>[p("div",null,[$e,r(a(ae),{size:"small",value:d.value,"onUpdate:value":n[1]||(n[1]=m=>d.value=m)},null,8,["value"])])]),default:l(()=>[r(a(ne),{show:t.value,"onUpdate:show":n[3]||(n[3]=m=>t.value=m),preset:"dialog",title:"create user","positive-text":"submit","negative-text":"cancel",style:{position:"fixed",top:"11rem",left:"50%",transform:"translateX(-50%)"},onPositiveClick:I,onNegativeClick:i},{default:l(()=>[p("div",null,[Ne,r(a(re),{value:o.value,"onUpdate:value":n[2]||(n[2]=m=>o.value=m),type:"text",placeholder:"eg: ovpn-20231212"},null,8,["value"])])]),_:1},8,["show"]),r(a(oe),{columns:N.value,bordered:!1,"single-line":!1,striped:!0,"scroll-x":300,data:a(s).users.value,pagination:$,"paginate-single-page":!1},null,8,["columns","data"]),r(a(ie),{bottom:5,right:5,"visibility-height":300})]),_:1}))}},be=D(Ue,[["__scopeId","data-v-aa47032d"]]),Ie={__name:"MessageContainer",setup(e){return window.$message=le(),(s,c)=>(_(),x("div"))}},ke={__name:"DialogContainer",setup(e){return window.$dialog=ce(),(s,c)=>(_(),x("div"))}};const j=e=>(M("data-v-acb9af91"),e=e(),R(),e),Ce=j(()=>p("header",null,[p("img",{src:me,style:{width:"40px",height:"40px",margin:"12px 10px 0 10px"}}),p("h2",{style:{"margin-top":"12px"}},"OpenVPN Manager")],-1)),Le={class:"wrapper"},Se=j(()=>p("footer",null,[v("Â© Based on "),p("a",{href:"https://github.com/Nyr/openvpn-install"},"OpenVPN installation script"),v(" maintained by Nyr 2023")],-1)),Pe={__name:"App",setup(e){return(s,c)=>(_(),x(b,null,[Ce,r(a(ue),null,{default:l(()=>[r(Ie)]),_:1}),r(a(de),null,{default:l(()=>[r(ke)]),_:1}),p("div",Le,[r(a(pe),{type:"segment"},{default:l(()=>[r(a(L),{name:"vpn-info",tab:"VPN Info"},{default:l(()=>[r(he)]),_:1}),r(a(L),{name:"user-manager",tab:"User Manager"},{default:l(()=>[r(be)]),_:1})]),_:1})]),Se],64))}},Oe=D(Pe,[["__scopeId","data-v-acb9af91"]]),F=K(Oe),Te=Q();F.use(Te);F.mount("#app");
