import{au as P,av as O,an as T,r as y,aw as A,ax as v,ay as h,az as o,aA as c,aB as r,F as x,aC as H,aD as X,c as _,aE as k,aF as d,B as w,aG as J,$ as C,v as I,aH as M,aI as R,aJ as K,aK as Q}from"./chunks/vendor.0cb8c3a3.js";import{N as Y,a as Z,b as ee,c as L,d as te,e as $,f as se,g as ne,h as ae,i as re,j as oe,k as ie,l as le,u as ce,m as ue,n as de,o as pe,p as S,q as me}from"./chunks/navie-ui.f0d50f0d.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))u(s);new MutationObserver(s=>{for(const t of s)if(t.type==="childList")for(const m of t.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&u(m)}).observe(document,{childList:!0,subtree:!0});function l(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerPolicy&&(t.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?t.credentials="include":s.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function u(s){if(s.ep)return;s.ep=!0;const t=l(s);fetch(s.href,t)}})();const fe=""+new URL("../img/ovpnmgr.png",import.meta.url).href,f=P.create({baseURL:{}.VUE_APP_BASE_API,timeout:5e3});f.interceptors.request.use(e=>e,e=>(console.log(e),Promise.reject(e)));f.interceptors.response.use(e=>{const{status:n,data:l}=e;switch(n){case 209:window.$message.warning(l.response.msg,{duration:2e3})}return Promise.resolve(l)},e=>{const{status:n,data:l}=e.response;switch(n){case 401:case 403:window.$message.error("No Permission, Please Login!",{duration:2e3});break;default:window.$message.error(l.response.msg||e.message,{duration:2e3})}return Promise.reject(e)});function V(e){return f({url:"/api/vm/info",method:"get",params:e})}function ge(){return f({url:"/api/ovpn/restart",method:"get"})}function ve(){return f({url:"/api/ovpn/status",method:"get"})}const _e=O("vpn",()=>{const e=T({}),n=y("click 'check' to get!");return{vmIpInfo:e,ovpnStatusResult:n,getVmIpInfo:async()=>{const u=await V();e.value=u}}});const he=["innerHTML"],we={__name:"VpnInfo",setup(e){const n=_e(),{vmIpInfo:l,ovpnStatusResult:u}=A(n);Object.keys(l.value).length===0&&V().then(t=>{n.vmIpInfo.value=t}).catch(t=>{console.error("Error fetching VPN info:",t)});function s(){ve().then(t=>{n.ovpnStatusResult=`<pre class="scrollable-pre">${t.response.msg}</pre>`}).catch(t=>{console.log(t),window.$message.error(`get openvpn status error: ${t}`,{duration:2e3})})}return(t,m)=>(v(),h(x,null,[o(r(te),{bordered:""},{default:c(()=>[o(r(Y),null,{default:c(()=>[(v(!0),h(x,null,H(r(l).value,(b,N,U)=>(v(),X(r(Z),{key:U},{default:c(()=>[o(r(ee),{cols:16,"item-responsive":""},{default:c(()=>[o(r(L),{class:"name",span:"0 500:3"},{default:c(()=>[_(k(N.toUpperCase()),1)]),_:2},1024),o(r(L),{class:"value",span:"16 500:13"},{default:c(()=>[_(k(b),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),o(r(se),{title:"Openvpn Service Status"},{"header-extra":c(()=>[o(r($),{onClick:s,size:"small",type:"info"},{default:c(()=>[_(" Check ")]),_:1})]),default:c(()=>[d("div",{innerHTML:r(u)},null,8,he)]),_:1})],64))}};function E(e){return f({url:"/api/user/show",method:"get",timeout:6e4,params:e})}function ye(e){return f({url:"/api/user/add",method:"post",data:e})}function $e(e){return f({url:`/api/user/revoke/${e}`,method:"delete"})}const xe=O("users",()=>{const e=T([]);return{users:e,getUsersList:async()=>{const s=await E();e.value=s},addUserLocal:s=>{e.value.unshift(s)},delUserLocal:s=>{let t=e.value.findIndex(m=>m.username===s);t!==-1&&e.value.splice(t,1)}}});const B=(e,n)=>{const l=e.__vccOpts||e;for(const[u,s]of n)l[u]=s;return l},D=e=>(M("data-v-98d99f81"),e=e(),R(),e),be={class:"controlbar-wrapper"},Ne={class:"controlbar-left"},Ue=D(()=>d("span",{style:{"margin-right":"5px"}},"Edit",-1)),ke={class:"controlbar-right"},Ce=D(()=>d("div",null,"username",-1)),Ie={__name:"UserManager",setup(e){const n=xe(),{users:l}=A(n);Object.keys(l.value).length===0&&E().then(i=>{n.users.value=i.response.users}).catch(i=>{console.error("Error fetching users:",i)});const u=y(!1),s=y(!1),t=y("");function m(){window.$message.warning("Canceled!")}function b(){const i=JSON.stringify({username:t.value});ye(i).then(a=>{console.log(a.response.msg,a.status),a.status==="success"&&(n.addUserLocal({username:t.value}),window.$message.success(`[${t.value}] creat success`,{duration:2e3}))}).catch(a=>{window.$message.error(`Error when creating users: ${a}`,{duration:2e3})})}const N={pageSize:10};function U(){window.$dialog.warning({title:"Warning",content:"Are you sure to restart openvpn service?",positiveText:"Sure",negativeText:"Cancel",style:"position: fixed; top: 11rem; left: 50%; transform: translateX(-50%)",onPositiveClick:()=>{ge().then(i=>{console.log(i.response.msg),window.$message.success("openvpn service is restart",{duration:2e3})}).catch(i=>{window.$message.error(`openvpn service restart error: ${i}`,{duration:2e3})})}})}const F=y([{title:"User",key:"username",align:"center",titleAlign:"center",minWidth:50},{title:"Manage",key:"manage",align:"center",titleAlign:"center",minWidth:200,render(i){return w("div",[w($,{text:!0,size:"small",strong:!0,type:"primary",style:{display:u.value?"none":"inline-flex"},onClick:()=>W(i.username)},{default:()=>"Download Ovpn File",icon:()=>w(ne,{color:"#000",size:24},{default:()=>w(J)})}),w($,{strong:!0,size:"small",type:"error",style:{display:u.value?"inline-flex":"none"},onClick:()=>q(i)},{default:()=>"delete"})])}}]);function W(i){P({method:"get",url:`/api/user/cert/${i}.ovpn`,responseType:"blob"}).then(a=>{let p=a.data;if(!p)return;let G=window.URL.createObjectURL(new Blob([p],{type:"application/octet-stream"})),g=document.createElement("a");g.style.display="none",g.href=G,g.setAttribute("download",`${i}.ovpn`),document.body.appendChild(g),g.click(),window.URL.revokeObjectURL(g.href),document.body.removeChild(g)}).catch(a=>{window.$message.error(`${a.response.status} ${a.response.statusText}`,{duration:2e3})})}function q(i){window.$dialog.warning({title:"Warning",content:`Are you sure to delete user [ ${i.username} ]?`,positiveText:"Sure",negativeText:"Cancel",style:"position: fixed; top: 11rem; left: 50%; transform: translateX(-50%)",onPositiveClick:()=>{$e(i.username).then(a=>{console.log(a.response.msg),window.$message.success(`[ ${i.username} ] is deleted, click [restart] will finally take effect.`,{duration:2e3}),n.delUserLocal(i.username)}).catch(a=>{window.$message.error(`Error while deleting users: ${a}`,{duration:2e3})})}})}return(i,a)=>(v(),h(x,null,[d("div",be,[d("div",Ne,[Ue,o(r(ae),{size:"small",value:u.value,"onUpdate:value":a[0]||(a[0]=p=>u.value=p)},null,8,["value"])]),d("div",ke,[C(o(r($),{onClick:a[1]||(a[1]=p=>s.value=!0),size:"small",color:"#44aaee"},{default:c(()=>[_(" Create ")]),_:1},512),[[I,!u.value]]),C(o(r($),{onClick:U,size:"small",type:"warning"},{default:c(()=>[_(" restart ")]),_:1},512),[[I,u.value]])])]),o(r(oe),{show:s.value,"onUpdate:show":a[3]||(a[3]=p=>s.value=p),preset:"dialog",title:"create user","positive-text":"submit","negative-text":"cancel",style:{position:"fixed",top:"11rem",left:"50%",transform:"translateX(-50%)"},onPositiveClick:b,onNegativeClick:m},{default:c(()=>[d("div",null,[Ce,o(r(re),{value:t.value,"onUpdate:value":a[2]||(a[2]=p=>t.value=p),type:"text",placeholder:"eg: ovpn-20231212"},null,8,["value"])])]),_:1},8,["show"]),o(r(ie),{columns:F.value,bordered:!1,"single-line":!1,striped:!0,"scroll-x":300,data:r(n).users.value,pagination:N,"paginate-single-page":!1},null,8,["columns","data"]),o(r(le),{bottom:5,right:5,"visibility-height":300})],64))}},Le=B(Ie,[["__scopeId","data-v-98d99f81"]]),Se={__name:"MessageContainer",setup(e){return window.$message=ce(),(n,l)=>(v(),h("div"))}},Pe={__name:"DialogContainer",setup(e){return window.$dialog=ue(),(n,l)=>(v(),h("div"))}};const z=e=>(M("data-v-acb9af91"),e=e(),R(),e),Oe=z(()=>d("header",null,[d("img",{src:fe,style:{width:"40px",height:"40px",margin:"12px 10px 0 10px"}}),d("h2",{style:{"margin-top":"12px"}},"OpenVPN Manager")],-1)),Te={class:"wrapper"},Ae=z(()=>d("footer",null,[_("Â© Based on "),d("a",{href:"https://github.com/Nyr/openvpn-install"},"OpenVPN installation script"),_(" maintained by Nyr 2023")],-1)),Me={__name:"App",setup(e){return(n,l)=>(v(),h(x,null,[Oe,o(r(de),null,{default:c(()=>[o(Se)]),_:1}),o(r(pe),null,{default:c(()=>[o(Pe)]),_:1}),d("div",Te,[o(r(me),{type:"segment"},{default:c(()=>[o(r(S),{name:"vpn-info",tab:"VPN Info"},{default:c(()=>[o(we)]),_:1}),o(r(S),{name:"user-manager",tab:"User Manager"},{default:c(()=>[o(Le)]),_:1})]),_:1})]),Ae],64))}},Re=B(Me,[["__scopeId","data-v-acb9af91"]]),j=K(Re),Ve=Q();j.use(Ve);j.mount("#app");
